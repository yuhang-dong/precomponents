---
import HeaderLayout from "../../layouts/HeaderLayout.astro";
import { parseDocsFromSectionAndEntries } from "../../utils/storybookEntriesUtils";

export async function getStaticPaths() {
  const mode = await import("virtual:storybook-index");
  const indexEndpoint = mode?.value;
  const sections = Array.from(
    new Set(
      Object.values(indexEndpoint.entries).map(entry =>
        entry.title.includes("/") ? entry.title.split("/")[0].toLocaleLowerCase() : "home"
      )
    )
  );
  return sections.map(section => ({ params: { section } }));
}

const { section } = Astro.params;
const mode = await import("virtual:storybook-index");
const indexEndpoint = mode?.value;
const docs = parseDocsFromSectionAndEntries(section, indexEndpoint.entries);
console.log('Docs for section:', section, docs);
const firstDoc = docs[0];
if (firstDoc) {
  return Astro.redirect(`/${section.toLocaleLowerCase()}/${firstDoc.id}`);
}
---
<HeaderLayout title="StoryDoc" docs={docs}>
  <section style="padding: 48px; text-align: center;">
    <h2>No Docs In Here</h2>
  </section>
</HeaderLayout>